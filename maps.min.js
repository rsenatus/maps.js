/**************************************************************************
* name : maps.js V1.0.1                                        *
* Cett oeuvre est mise à disposition selon les termes de la Licence       *
* Creative Commons Attribution 3 (BY NC SA) - Pas d’utilisation           *
* commerciale - Partage dans les mêmes conditions 3.0 France.             *
* http://creativecommons.org/licenses/by-nc-sa/3.0/fr/                    *
*                                                                         *
* Vous devez inclure ce fichier en cas de redistribution.                 *
* Vous n'avez pas le droit d'utiliser la clé map du propriétaire.         *
* Vous devez afin d'utiliser le logiciel en créer un gratuitement sur     *
* le site de google. En cas d'utilisation de la clé de l'auteur,          *
* les requêtes que vous avez effectuées avec cette clé                    *
* vous incombent.                                                         *
*                                                                         *
* contact : contact@getinit.fr, rsenatus@free.fr                          *
**************************************************************************/

function Map(n,t){function l(a){return new google.maps.LatLng(a.lat,a.lng)}function A(a,c,b){function e(){"undefined"==typeof g&&(g=q);d.setZoom(g);d.setCenter(f)}var f={},g=c;switch(typeof a){case "string":r(a,function(a,c,u,b){u&&(f=l({lat:u,lng:b}),e())});break;case "object":f=l({lat:a.lat,lng:a.lng});break;default:f=l(s)}"string"!=typeof a&&e();"function"==typeof b&&b()}function B(a,c){google.maps.event.addListener(d,a,function(a){"function"==typeof c&&c(a)})}function r(a,c){C.geocode({address:a}, function(a,b){switch(b){case "OK":var d=parseFloat(a[0].geometry.location.lat()),g=parseFloat(a[0].geometry.location.lng());e("lat : "+d+" lng : "+g);"function"==typeof c&&c(a,b,d,g);break;default:e("Error on location position : "+lastPosition),"function"==typeof c&&c(a,b,!1,!1)}})}function D(a,c){var b,l=function(a){var c=new google.maps.LatLng(a.coords.latitude,a.coords.longitude);void 0==b&&(b=new google.maps.Marker({map:d}));b.setPosition(c);e(a.coords.latitude+" "+a.coords.longitude)},f=function(a){switch(a.code){case a.PERMISSION_DENIED:e("L'acc\u00e8s \u00e0 la g\u00e9ollocalisation est r\u00e9fus\u00e9."); break;case a.POSITION_UNAVAILABLE:e("L'emplacement de l'utilisateur n'a pas pu \u00eatre d\u00e9termin\u00e9");break;case a.TIMEOUT:e("Le service n'a pas r\u00e9pondu \u00e0 temps")}};navigator.geolocation?("function"==typeof a&&(l=a),"function"==typeof c&&(f=c),navigator.geolocation.watchPosition(l,f,{enableHighAccuracy:!0,timeout:8E4,maximumAge:9E5})):alert("La g\u00e9olocalisation n'est pas prise en compte")}function e(a,b){m&&console.log("debug : "+a);m&&b&&console.debug("debug : "+b)}function v(){d.getZoom()< w?d.setMapTypeId("Macro"):d.setMapTypeId("Micro")}var C=new google.maps.Geocoder,p="/images/m-markeryellow.png",x="/images/m-markerblue.png",s={lat:48.8533559,lng:2.3758022},d={},w=7,q=7,m=!1,b={},y=[{featureType:"poi",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"geometry",stylers:[{visibility:"simplified"}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"all"},{featureType:"landscape",elementType:"geometry.fill",stylers:[{visibility:"simplified"}]}], z=[{featureType:"poi",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"geometry",stylers:[{visibility:"simplified"}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"on"}]},{featureType:"water",elementType:"all",stylers:[{color:"#383838"}]},{featureType:"landscape",elementType:"geometry.fill",stylers:[{visibility:"simplified"}]}];this.getMap=function(){return d};this.getInfoWindow=function(a){var b=new google.maps.InfoWindow;a&&b.setContent(a);return b};this.getGoogleLatLng= function(a){l(a)};this.goTo=function(a,b,d){A(a,b,d)};this.zoomIn=function(){var a=d.getZoom()+1;18>=a&&d.setZoom(a)};this.zoomOut=function(){var a=d.getZoom()-1;18>=a&&d.setZoom(a)};this.setZoom=function(a){18>=a&&d.setZoom(a)};this.getZoom=function(){return d.getZoom()};this.handleMapEvent=function(a,b){B(a,b)};this.geoCodeRequest=function(a,b){r(a,b)};this.addMarker=function(a,b){function m(a,b,d){google.maps.event.addListener(a,"mouseover",function(){void 0==b?(e("marker 1 is undefined. On utilise le marker par d\u00e9fault"), a.setIcon(p)):(e("marker 1 is defined. On utilise le marker du tableau :"+b),a.setIcon(b))});google.maps.event.addListener(a,"mouseout",function(){void 0==d?(e("marker 2 is undefined. On utilise le marker par d\u00e9fault"),a.setIcon(x)):(e("marker 2 is defined. On utilise le marker du tableau :"+d),a.setIcon(d))})}function n(a,b){for(var c=new Number,f=new Number,c=0,f=a.length;c<f;c++){var g=l({lat:parseFloat(a[c].lat),lng:parseFloat(a[c].lng)}),k=new google.maps.Marker({position:g,map:d}),h;for(h in a[c])switch(h){case "marker":0< a[c][h].length&&(p=a[c][h])}k.setIcon(p);m(k,a[c].marker,a[c].markerOver);e("item: "+c+" lat : "+parseFloat(a[c].lat)+" lang : "+parseFloat(a[c].lng)+" icon1 : "+p+" icon2 : "+x+" location (obj latlng) : "+g);a[c].m=k}"function"==typeof b&&b(a)}function f(){0<h.length?(k=h[h.length-1].position,"string"==typeof a[k].xlocation&&0<a[k].xlocation.length&&r(a[k].xlocation,function(b,c,d,e){h.pop();switch(c){case "OK":a[k].lat=d,a[k].lng=e}f()})):(e("end geocode request"),n(a,b))}function g(){for(var b= 0,c=a.length;b<c;b++)(isNaN(parseInt(a[b].lat))||"undefined"==a[b].lat||isNaN(parseInt(a[b].lng))||"undefined"==a[b].lng)&&h.push({position:b});f()}var h=[],k=new Number;"object"!=typeof a?e("map.addMarker : not an array object"):g()};this.geolocation=function(a,b){D(a,b)};(function(){if("string"!=typeof n||null==document.getElementById(n))e("container error");else if(t){b=t;for(var a in b)switch(a){case "center":"number"==typeof b[a].lat&&"number"==typeof b[a].lng&&(s=b[a]);break;case "defZoom":"number"== typeof b[a]&&0<b[a]&&(q=b[a]);break;case "styleMacro":"array"==typeof b[a]&&(y=b[a]);break;case "styleMicro":"array"==typeof b[a]&&(z=b[a]);break;case "zoomLevelToSwapMapStyle":"number"==typeof b[a]&&(w=b[a]);break;case "debug":b[a]&&(m=b[a])}}b.center=l(s);b.zoom=q;b.mapTypeControl=!1;d=new google.maps.Map(document.getElementById(n),b);e("Loading google map");a=new google.maps.StyledMapType(y,{name:"Macro"});var c=new google.maps.StyledMapType(z,{name:"Micro"});d.mapTypes.set("Macro",a);d.mapTypes.set("Micro", c);v();google.maps.event.addListener(d,"zoom_changed",function(){18<d.getZoom()&&d.setZoom(18);e("Actual zoom :"+d.getZoom());v()});m&&e("debug is on. You should turn it off")})()};